<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Simple Diary</title>
<!-- Quill CDN -->
<link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
<style>
body{margin:0;font-family:sans-serif;display:flex;height:100vh}
#sidebar{width:280px;background:#f5f5f5;border-right:1px solid #ddd;overflow-y:auto;padding:1rem;box-sizing:border-box}
#sidebar h2{margin-top:0;font-size:1.1rem}
#entryList button{display:block;width:100%;text-align:left;margin:.25rem 0;padding:.35rem;border:none;background:#fff;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.1);cursor:pointer}
#entryList button.active{background:#cfe8ff}
#editorArea{flex:1;display:flex;flex-direction:column}
#toolbar{border-bottom:1px solid #ddd}
#title{width:100%;border:none;border-bottom:1px solid #ddd;font-size:1.2rem;padding:.5rem}
#buttons{padding:.5rem;border-top:1px solid #ddd;text-align:right}
#buttons button{margin-left:.5rem;padding:.4rem .8rem}
</style>
</head>
<body>

<!-- ì‚¬ì´ë“œë°” â€“ ì €ì¥ëœ ì¼ê¸° ëª©ë¡ -->
<aside id="sidebar">
  <h2>ğŸ“” My Diary</h2>
  <button id="newEntryBtn">+ ìƒˆ ê¸€</button>
  <div id="entryList"></div>
</aside>

<!-- ì—ë””í„° ì˜ì—­ -->
<section id="editorArea">
  <!-- ì œëª© -->
  <input id="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />

  <!-- Quill íˆ´ë°” -->
  <div id="toolbar">
    <span class="ql-formats">
      <select class="ql-header">
        <option selected></option>
        <option value="2"></option>
        <option value="3"></option>
      </select>
      <button class="ql-bold"></button>
      <button class="ql-italic"></button>
      <button class="ql-underline"></button>
      <button class="ql-image"></button>
    </span>
  </div>

  <!-- ì‹¤ì œ ì—ë””í„° -->
  <div id="editor" style="flex:1;overflow-y:auto;"></div>

  <!-- í•˜ë‹¨ ë²„íŠ¼ -->
  <div id="buttons">
    <button id="saveBtn">ğŸ’¾ ì €ì¥</button>
    <button id="deleteBtn">ğŸ—‘ï¸ ì‚­ì œ</button>
  </div>
</section>

<script>
/* ---------- Quill ì„¸íŒ… ---------- */
const quill = new Quill('#editor', {
  theme: 'snow',
  modules: { toolbar: '#toolbar' }
});

/* ---------- ì „ì—­ ë³€ìˆ˜ ---------- */
let currentId = null;           // ì—´ëŒÂ·í¸ì§‘ ì¤‘ì¸ ì¼ê¸° ID
const STORAGE_KEY = 'myDiary';  // localStorage í‚¤
const entryListEl = document.getElementById('entryList');

/* ---------- ìœ í‹¸: ì €ì¥ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ---------- */
function loadAllEntries(){
  return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
}

/* ---------- ìœ í‹¸: ë°ì´í„° ì €ì¥ ---------- */
function saveAllEntries(list){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
}

/* ---------- ëª©ë¡ ê°±ì‹  ---------- */
function renderEntryList(activeId=null){
  const list = loadAllEntries();
  entryListEl.innerHTML = '';
  list.forEach(entry=>{
    const btn = document.createElement('button');
    btn.textContent = entry.title || '(ì œëª© ì—†ìŒ)';
    if(entry.id === activeId) btn.classList.add('active');
    btn.onclick = ()=>openEntry(entry.id);
    entryListEl.appendChild(btn);
  });
}

/* ---------- ìƒˆ ê¸€ ---------- */
document.getElementById('newEntryBtn').onclick = ()=>{
  currentId = null;
  document.getElementById('title').value = '';
  quill.setContents([]);
  renderEntryList();            // í™œì„± í‘œì‹œ í•´ì œ
}

/* ---------- ê¸€ ì—´ê¸° ---------- */
function openEntry(id){
  const entry = loadAllEntries().find(e=>e.id===id);
  if(!entry) return;
  currentId = id;
  document.getElementById('title').value = entry.title;
  quill.root.innerHTML = entry.content;
  renderEntryList(id);
}

/* ---------- ì €ì¥ ---------- */
document.getElementById('saveBtn').onclick = ()=>{
  const title = document.getElementById('title').value.trim();
  const content = quill.root.innerHTML;
  if(!content.replace(/<(.|\n)*?>/g,'').trim() && !title){
    alert('ë‚´ìš©ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.'); return;
  }
  let list = loadAllEntries();
  if(currentId){  // ìˆ˜ì •
    list = list.map(e=> e.id===currentId ? {...e,title,content} : e);
  }else{          // ìƒˆ ê¸€
    currentId = Date.now().toString();
    list.unshift({id:currentId,title,content,created:new Date()});
  }
  saveAllEntries(list);
  renderEntryList(currentId);
  alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
}

/* ---------- ì‚­ì œ ---------- */
document.getElementById('deleteBtn').onclick = ()=>{
  if(!currentId){ alert('ì‚­ì œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
  if(!confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')) return;
  const list = loadAllEntries().filter(e=>e.id!==currentId);
  saveAllEntries(list);
  currentId = null;
  document.getElementById('title').value='';
  quill.setContents([]);
  renderEntryList();
}

/* ---------- ì²« ë Œë” ---------- */
renderEntryList();
</script>
</body>
</html>
